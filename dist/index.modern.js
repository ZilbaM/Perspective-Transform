import t,{useRef as e,useState as n,useLayoutEffect as o,useEffect as r}from"react";function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},i.apply(null,arguments)}function c({children:c}){const u=e(null),[l,s]=n({topLeft:{x:0,y:0},topRight:{x:100,y:0},bottomRight:{x:100,y:100},bottomLeft:{x:0,y:100}}),[f,h]=n(""),[a,d]=n(!1);return o(()=>{if(u.current){const t=u.current.getBoundingClientRect();t.width>0&&t.height>0&&s({topLeft:{x:0,y:0},topRight:{x:t.width,y:0},bottomRight:{x:t.width,y:t.height},bottomLeft:{x:0,y:t.height}})}},[c]),o(()=>{if(u.current){const t=u.current.getBoundingClientRect();if(0===t.width||0===t.height)return;const e=function(t,e){function n(t,e,n,o){const r=[t.x,e.x,n.x,t.y,e.y,n.y,1,1,1],i=function(t,e){const n=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);if(0===n)return null;const o=1/n,r=[t[4]*t[8]-t[5]*t[7],t[2]*t[7]-t[1]*t[8],t[1]*t[5]-t[2]*t[4],t[5]*t[6]-t[3]*t[8],t[0]*t[8]-t[2]*t[6],t[2]*t[3]-t[0]*t[5],t[3]*t[7]-t[4]*t[6],t[1]*t[6]-t[0]*t[7],t[0]*t[4]-t[1]*t[3]].map(t=>t*o);return[r[0]*e[0]+r[1]*e[1]+r[2]*e[2],r[3]*e[0]+r[4]*e[1]+r[5]*e[2],r[6]*e[0]+r[7]*e[1]+r[8]*e[2]]}(r,[o.x,o.y,1]);return null===i?null:[r[0]*i[0],r[1]*i[1],r[2]*i[2],r[3]*i[0],r[4]*i[1],r[5]*i[2],r[6]*i[0],r[7]*i[1],r[8]*i[2]]}const o=n(t[0],t[1],t[2],t[3]),r=n(e[0],e[1],e[2],e[3]);if(null===o||null===r)return"";const i=function(t,e){const n=[];for(let o=0;o<3;o+=1)for(let r=0;r<3;r+=1){let i=0;for(let n=0;n<3;n+=1)i+=t[3*o+n]*e[3*n+r];n[3*o+r]=i}return n}(r,[(c=o)[4]*c[8]-c[5]*c[7],c[2]*c[7]-c[1]*c[8],c[1]*c[5]-c[2]*c[4],c[5]*c[6]-c[3]*c[8],c[0]*c[8]-c[2]*c[6],c[2]*c[3]-c[0]*c[5],c[3]*c[7]-c[4]*c[6],c[1]*c[6]-c[0]*c[7],c[0]*c[4]-c[1]*c[3]]);var c;for(let t=0;t<i.length;t+=1)i[t]/=i[8];return`matrix3d(${[i[0],i[3],0,i[6],i[1],i[4],0,i[7],0,0,1,0,i[2],i[5],0,i[8]].join(",")})`}([{x:0,y:0},{x:t.width,y:0},{x:t.width,y:t.height},{x:0,y:t.height}],[l.topLeft,l.topRight,l.bottomRight,l.bottomLeft]);h(e)}},[l]),r(()=>{const t=t=>{!t.shiftKey||"p"!==t.key&&"P"!==t.key||d(t=>!t)};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[]),/*#__PURE__*/t.createElement("div",{ref:u,className:"perspective-container"},/*#__PURE__*/t.createElement("div",{style:{transform:f,transformOrigin:"0 0",width:"100%",height:"100%"}},c),a&&Object.entries(l).map(([e,{x:n,y:o}])=>/*#__PURE__*/t.createElement("div",{key:e,className:"control-point",style:{left:n,top:o},onMouseDown:t=>((t,e)=>{t.preventDefault(),t.stopPropagation();const n=t=>{if(u.current){const n=u.current.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top;s(t=>i({},t,{[e]:{x:o,y:r}}))}},o=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)})(t,e)})))}export{c as default};
//# sourceMappingURL=index.modern.js.map
