{"version":3,"file":"index.cjs","sources":["../src/index.js"],"sourcesContent":["import React, { useState, useRef, useLayoutEffect, useEffect } from \"react\";\nimport \"./style.css\"; // Import the CSS file\n\nfunction PerspectiveTransform({ children }) {\n  const containerRef = useRef(null);\n  const [points, setPoints] = useState({\n    topLeft: { x: 0, y: 0 },\n    topRight: { x: 100, y: 0 },\n    bottomRight: { x: 100, y: 100 },\n    bottomLeft: { x: 0, y: 100 },\n  });\n  const [matrix, setMatrix] = useState(\"\");\n  const [editable, setEditable] = useState(false); // Editable state\n\n  // Function to compute the CSS matrix\n  function computeCssMatrix(srcPoints, dstPoints) {\n    function solve(A, b) {\n      const det =\n        A[0] * (A[4] * A[8] - A[5] * A[7]) -\n        A[1] * (A[3] * A[8] - A[5] * A[6]) +\n        A[2] * (A[3] * A[7] - A[4] * A[6]);\n\n      if (det === 0) return null;\n\n      const invDet = 1 / det;\n\n      const adjA = [\n        A[4] * A[8] - A[5] * A[7],\n        A[2] * A[7] - A[1] * A[8],\n        A[1] * A[5] - A[2] * A[4],\n        A[5] * A[6] - A[3] * A[8],\n        A[0] * A[8] - A[2] * A[6],\n        A[2] * A[3] - A[0] * A[5],\n        A[3] * A[7] - A[4] * A[6],\n        A[1] * A[6] - A[0] * A[7],\n        A[0] * A[4] - A[1] * A[3],\n      ].map((val) => val * invDet);\n\n      return [\n        adjA[0] * b[0] + adjA[1] * b[1] + adjA[2] * b[2],\n        adjA[3] * b[0] + adjA[4] * b[1] + adjA[5] * b[2],\n        adjA[6] * b[0] + adjA[7] * b[1] + adjA[8] * b[2],\n      ];\n    }\n\n    function adj(m) {\n      return [\n        m[4] * m[8] - m[5] * m[7],\n        m[2] * m[7] - m[1] * m[8],\n        m[1] * m[5] - m[2] * m[4],\n        m[5] * m[6] - m[3] * m[8],\n        m[0] * m[8] - m[2] * m[6],\n        m[2] * m[3] - m[0] * m[5],\n        m[3] * m[7] - m[4] * m[6],\n        m[1] * m[6] - m[0] * m[7],\n        m[0] * m[4] - m[1] * m[3],\n      ];\n    }\n\n    function multmm(a, b) {\n      const c = [];\n      for (let i = 0; i < 3; i += 1) {\n        for (let j = 0; j < 3; j += 1) {\n          let cij = 0;\n          for (let k = 0; k < 3; k += 1) {\n            cij += a[3 * i + k] * b[3 * k + j];\n          }\n          c[3 * i + j] = cij;\n        }\n      }\n      return c;\n    }\n\n    function basisToPoints(p1, p2, p3, p4) {\n      const m = [p1.x, p2.x, p3.x, p1.y, p2.y, p3.y, 1, 1, 1];\n      const v = [p4.x, p4.y, 1];\n      const s = solve(m, v);\n      if (s === null) return null;\n      const m2 = [\n        m[0] * s[0],\n        m[1] * s[1],\n        m[2] * s[2],\n        m[3] * s[0],\n        m[4] * s[1],\n        m[5] * s[2],\n        m[6] * s[0],\n        m[7] * s[1],\n        m[8] * s[2],\n      ];\n      return m2;\n    }\n\n    const m1 = basisToPoints(\n      srcPoints[0],\n      srcPoints[1],\n      srcPoints[2],\n      srcPoints[3]\n    );\n    const m2 = basisToPoints(\n      dstPoints[0],\n      dstPoints[1],\n      dstPoints[2],\n      dstPoints[3]\n    );\n    if (m1 === null || m2 === null) return \"\";\n\n    const m3 = multmm(m2, adj(m1));\n\n    for (let i = 0; i < m3.length; i += 1) {\n      m3[i] /= m3[8];\n    }\n\n    const matrix3d = [\n      m3[0],\n      m3[3],\n      0,\n      m3[6],\n      m3[1],\n      m3[4],\n      0,\n      m3[7],\n      0,\n      0,\n      1,\n      0,\n      m3[2],\n      m3[5],\n      0,\n      m3[8],\n    ];\n\n    return `matrix3d(${matrix3d.join(\",\")})`;\n  }\n\n  useLayoutEffect(() => {\n    if (containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      if (rect.width > 0 && rect.height > 0) {\n        setPoints({\n          topLeft: { x: 0, y: 0 },\n          topRight: { x: rect.width, y: 0 },\n          bottomRight: { x: rect.width, y: rect.height },\n          bottomLeft: { x: 0, y: rect.height },\n        });\n      }\n    }\n  }, [children]);\n\n  useLayoutEffect(() => {\n    if (containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      if (rect.width === 0 || rect.height === 0) return;\n\n      const srcCorners = [\n        { x: 0, y: 0 },\n        { x: rect.width, y: 0 },\n        { x: rect.width, y: rect.height },\n        { x: 0, y: rect.height },\n      ];\n      const dstCorners = [\n        points.topLeft,\n        points.topRight,\n        points.bottomRight,\n        points.bottomLeft,\n      ];\n      const transform = computeCssMatrix(srcCorners, dstCorners);\n      setMatrix(transform);\n    }\n  }, [points]);\n\n  const handleDrag = (e, corner) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const onMove = (event) => {\n      if (containerRef.current) {\n        const rect = containerRef.current.getBoundingClientRect();\n        const x = event.clientX - rect.left;\n        const y = event.clientY - rect.top;\n\n        setPoints((prevPoints) => ({\n          ...prevPoints,\n          [corner]: { x, y },\n        }));\n      }\n    };\n\n    const onUp = () => {\n      document.removeEventListener(\"mousemove\", onMove);\n      document.removeEventListener(\"mouseup\", onUp);\n    };\n\n    document.addEventListener(\"mousemove\", onMove);\n    document.addEventListener(\"mouseup\", onUp);\n  };\n\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.shiftKey && (e.key === \"p\" || e.key === \"P\")) {\n        setEditable((prevEditable) => !prevEditable);\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, []);\n\n  return (\n    <div ref={containerRef} className=\"perspective-container\">\n      <div\n        style={{\n          transform: matrix,\n          transformOrigin: \"0 0\",\n          width: \"100%\",\n          height: \"100%\",\n        }}\n      >\n        {children}\n      </div>\n\n      {editable &&\n        Object.entries(points).map(([corner, { x, y }]) => (\n          <div\n            key={corner}\n            className=\"control-point\"\n            style={{ left: x, top: y }}\n            onMouseDown={(e) => handleDrag(e, corner)}\n          />\n        ))}\n    </div>\n  );\n}\n\nexport default PerspectiveTransform;\n"],"names":["_ref","children","containerRef","useRef","_useState","useState","topLeft","x","y","topRight","bottomRight","bottomLeft","points","setPoints","_useState2","matrix","setMatrix","_useState3","editable","setEditable","useLayoutEffect","current","rect","getBoundingClientRect","width","height","transform","srcPoints","dstPoints","basisToPoints","p1","p2","p3","p4","m","s","A","b","det","invDet","adjA","map","val","solve","m1","m2","m3","a","c","i","j","cij","k","multmm","length","matrix3d","join","computeCssMatrix","useEffect","handleKeyDown","e","shiftKey","key","prevEditable","window","addEventListener","removeEventListener","React","createElement","ref","className","style","transformOrigin","Object","entries","_ref2","corner","_ref2$","left","top","onMouseDown","preventDefault","stopPropagation","onMove","event","clientX","clientY","prevPoints","_extends2","_extends","onUp","document","handleDrag"],"mappings":"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"}